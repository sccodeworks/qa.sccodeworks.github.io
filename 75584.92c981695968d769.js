"use strict";(self.webpackChunksc_codeworks_app=self.webpackChunksc_codeworks_app||[]).push([[75584],{75584:(w,p,o)=>{o.r(p),o.d(p,{RfEquipmentQuestionsComponent:()=>y});var u=o(24006),_=o(65412),d=o(98739),l=o(7155),f=o(48529),E=o(70879),M=o(35226),h=o.n(M),t=o(94650),C=o(19132),N=o(30294),R=o(36895),Z=o(97392),A=o(4859),g=o(59549),T=o(44144),c=o(73546);function Q(i,s){if(1&i&&(t.TgZ(0,"h3"),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.dataSource.data[0].MaintQuestions," ")}}function I(i,s){if(1&i&&(t.TgZ(0,"div",25),t._uU(1," Notes"),t._UZ(2,"br"),t.YNc(3,Q,2,1,"h3",26),t.qZA()),2&i){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",e.dataSource.data.length)}}function D(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",27)(1,"mat-form-field",8)(2,"mat-label"),t._uU(3,"Note 1"),t.qZA(),t._UZ(4,"input",28),t.qZA(),t.TgZ(5,"mat-form-field",8)(6,"mat-label"),t._uU(7,"Note 2"),t.qZA(),t._UZ(8,"input",29),t.qZA(),t.TgZ(9,"mat-form-field",8)(10,"mat-label"),t._uU(11,"Note 3"),t.qZA(),t._UZ(12,"input",30),t.qZA(),t.TgZ(13,"button",31),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.confirmMaint(a.dataSource.data[0]))}),t._uU(14," Submit\n"),t.qZA()()}if(2&i){const e=t.oxw();let n;t.xp6(13),t.Q6J("disabled",null==(n=e.form.get("Note1"))?null:n.invalid)}}function q(i,s){1&i&&(t.TgZ(0,"th",32),t._uU(1,"Sequence"),t.qZA())}function U(i,s){if(1&i&&(t.TgZ(0,"td",33),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.hij(" ",e.Sequence," ")}}function b(i,s){1&i&&(t.TgZ(0,"th",32),t._uU(1,"Maintenance Question"),t.qZA())}function v(i,s){if(1&i&&(t.TgZ(0,"td",33),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.hij(" ",e.MaintQuestions," ")}}function O(i,s){1&i&&t._UZ(0,"tr",34)}function S(i,s){1&i&&t._UZ(0,"tr",35)}function x(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",22),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onMaint())}),t._uU(1," M "),t.qZA()}}function P(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",22),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onYes(a.dataSource.data[0]))}),t._uU(1," Y "),t.qZA()}}let y=(()=>{class i{constructor(e,n,a,r,m,B,V){this.fb=e,this.router=n,this.matDialog=a,this.loginService=r,this.paginatorIntl=m,this.dialogRef=B,this.dialogData=V,this.displayedColumns=["Sequence","MaintQuestions"],this.user=localStorage.getItem("userName")||"",this.dataSource=new l.by,this.allQuestions=[],this.currentIndex=0,this.totalRecords=0,this.answerSelected=!1,this.showNotes=!1,this.isMaintConfirmed=!1,this.isCompleted=!1,this.completeMsg="Successfully Completed",this.firstApiOutputValue=null}ngOnInit(){this.element=this.dialogData||history.state,this.form=this.fb.group({Building:localStorage.getItem("building")||"",Equip:localStorage.getItem("equipment")||"",Meter:"",Note1:"",Note2:"",Note3:""}),this.element?.maintQuestions?.length&&this.bindMaintQuestions(this.element.maintQuestions),this.element?.building&&this.form.patchValue({Building:f.R.fullBuilding(this.element.building),Equip:this.element.equipment}),this.paginatorIntl.getRangeLabel=(e,n,a)=>0===a?"0 of 0":`${e+1} of ${a}`}bindMaintQuestions(e){this.allQuestions=e.map(n=>({MaintQuestions:n.EZQUES,Sequence:n.EZSEQ,Type:n.EZTYPE,Mandatory:n.EZMAND})),this.totalRecords=this.allQuestions.length,this.currentIndex=0,this.loadCurrentRecord()}nextRecord(){"Y"!==this.allQuestions[this.currentIndex].Mandatory||this.answerSelected?this.currentIndex!==this.totalRecords-1?(this.currentIndex++,this.loadCurrentRecord()):this.finishFlow():this.errorMessage("Some answers are Mandatory")}onYes(e){const n=this.form.value;this.loginService.updateBrake(this.user,f.R.fullBuilding(n.Building),n.Equip,e.Type,e.Sequence,"Y",n.Meter||0,e.MaintQuestions,"","","",this.firstApiOutputValue??0).subscribe(a=>{const m=a[0].data[a[0].data.length-1].value;null===this.firstApiOutputValue&&(this.firstApiOutputValue=a[0].data[a[0].data.length-2].value),m.toUpperCase()===this.completeMsg.toUpperCase()?(this.successMessage(m),this.answerSelected=!0):(this.answerSelected=!1,this.errorMessage(m))})}onMaint(){this.answerSelected=!1,this.showNotes=!0,this.form.get("Note1")?.setValidators([u.kI.required]),this.form.get("Note2")?.clearValidators(),this.form.get("Note3")?.clearValidators(),this.form.get("Note1")?.updateValueAndValidity(),this.form.get("Note2")?.updateValueAndValidity(),this.form.get("Note3")?.updateValueAndValidity()}confirmMaint(e){const n=this.form.value;this.loginService.updateBrake(this.user,f.R.fullBuilding(n.Building),n.Equip,e.Type,e.Sequence,"M",n.Meter||0,e.MaintQuestions,n.Note1,n.Note2,n.Note3,this.firstApiOutputValue??0).subscribe(a=>{const r=a[0].data[a[0].data.length-1].value;null===this.firstApiOutputValue&&(this.firstApiOutputValue=a[0].data[a[0].data.length-2].value),r.toUpperCase()===this.completeMsg.toUpperCase()?(this.successMessage(r),this.showNotes=!1,this.answerSelected=!0):(this.answerSelected=!1,this.errorMessage(r))})}loadCurrentRecord(){this.currentIndex>=this.totalRecords||(this.answerSelected=!1,this.showNotes=!1,this.form.patchValue({Note1:"",Note2:"",Note3:""}),this.form.get("Note1")?.clearValidators(),this.form.get("Note2")?.clearValidators(),this.form.get("Note3")?.clearValidators(),this.form.get("Note1")?.updateValueAndValidity(),this.form.get("Note2")?.updateValueAndValidity(),this.form.get("Note3")?.updateValueAndValidity(),this.dataSource.data=[this.allQuestions[this.currentIndex]],this.paginator&&(this.paginator.length=this.totalRecords,this.paginator.pageIndex=this.currentIndex))}finishFlow(){const e=localStorage.getItem("rfTargetPath")||"/main-nav";this.matDialog.closeAll(),this.matDialog.afterAllClosed.subscribe(()=>{this.router.navigateByUrl(e)})}successMessage(e){h().fire(e,"","success")}errorMessage(e){h().fire(e,"","error")}ngOnDestroy(){this.equipSubscription&&this.equipSubscription.unsubscribe()}ngAfterViewInit(){this.paginator&&(this.paginator._intl.getRangeLabel=(e,n,a)=>0===a?"0 of 0":`${e+1} of ${a}`)}closeDialog(){if(this.dialogRef)return void this.dialogRef.close(!1);const e=localStorage.getItem("rfTargetPath");this.router.navigateByUrl(e||"/main-nav")}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.qu),t.Y36(C.F0),t.Y36(_.uw),t.Y36(N.r),t.Y36(d.ye),t.Y36(_.so,8),t.Y36(_.WI,8))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-rf-equipment-questions"]],viewQuery:function(e,n){if(1&e&&t.Gf(d.NW,5),2&e){let a;t.iGM(a=t.CRH())&&(n.paginator=a.first)}},standalone:!0,features:[t.jDz],decls:41,vars:11,consts:[[1,"over-Flow"],[1,"main-header-title"],["mat-icon-button","",3,"click"],["mat-icon-button","","color","primary"],[1,"tally-serach-form"],[3,"formGroup"],[1,"row"],[1,"col"],["appearance","outline",1,"full-width"],["matInput","","formControlName","Building","readonly",""],["matInput","","formControlName","Equip","readonly",""],["matInput","","formControlName","Meter"],["style","margin-top: 12px",4,"ngIf"],["class","notes-section",4,"ngIf"],["mat-table","",1,"mat-elevation-z8","tally-table",3,"dataSource"],["matColumnDef","Sequence"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","MaintQuestions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"right-side"],[1,"buttons","button2",3,"click"],["class","buttons button2",3,"click",4,"ngIf"],["hidePageSize","","disabled","",1,"tally-table-pagination",3,"length","pageSize","pageIndex"],[2,"margin-top","12px"],[4,"ngIf"],[1,"notes-section"],["matInput","","formControlName","Note1","required",""],["matInput","","formControlName","Note2"],["matInput","","formControlName","Note3"],["mat-raised-button","","type","button",1,"buttons","addButton","tally-search-btn",3,"disabled","click"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(e,n){1&e&&(t.TgZ(0,"mat-card",0)(1,"div",1)(2,"mat-card-header")(3,"mat-card-title"),t._uU(4," Equipment Maintenance Questions"),t.qZA()(),t.TgZ(5,"button",2),t.NdJ("click",function(){return n.closeDialog()}),t.TgZ(6,"mat-icon",3),t._uU(7,"close"),t.qZA()()(),t.TgZ(8,"mat-card-content",4)(9,"form",5)(10,"div",6)(11,"div",7)(12,"mat-form-field",8)(13,"mat-label"),t._uU(14,"Building Number"),t.qZA(),t._UZ(15,"input",9),t.qZA(),t.TgZ(16,"mat-form-field",8)(17,"mat-label"),t._uU(18,"Equip#"),t.qZA(),t._UZ(19,"input",10),t.qZA(),t.TgZ(20,"mat-form-field",8)(21,"mat-label"),t._uU(22,"Meter"),t.qZA(),t._UZ(23,"input",11),t.qZA(),t.YNc(24,I,4,1,"div",12),t.YNc(25,D,15,1,"div",13),t.qZA()()()(),t.TgZ(26,"table",14),t.ynx(27,15),t.YNc(28,q,2,0,"th",16),t.YNc(29,U,2,1,"td",17),t.BQk(),t.ynx(30,18),t.YNc(31,b,2,0,"th",16),t.YNc(32,v,2,1,"td",17),t.BQk(),t.YNc(33,O,1,0,"tr",19),t.YNc(34,S,1,0,"tr",20),t.qZA(),t.TgZ(35,"div",21)(36,"button",22),t.NdJ("click",function(){return n.nextRecord()}),t._uU(37," Next "),t.qZA(),t.YNc(38,x,2,0,"button",23),t.YNc(39,P,2,0,"button",23),t.qZA(),t._UZ(40,"mat-paginator",24),t.qZA()),2&e&&(t.xp6(9),t.Q6J("formGroup",n.form),t.xp6(15),t.Q6J("ngIf",n.showNotes),t.xp6(1),t.Q6J("ngIf",n.showNotes),t.xp6(1),t.Q6J("dataSource",n.dataSource),t.xp6(7),t.Q6J("matHeaderRowDef",n.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",n.displayedColumns),t.xp6(4),t.Q6J("ngIf",!n.showNotes),t.xp6(1),t.Q6J("ngIf",!n.showNotes),t.xp6(1),t.Q6J("length",n.totalRecords)("pageSize",1)("pageIndex",n.currentIndex))},dependencies:[E.m,R.O5,u._Y,u.Fj,u.JJ,u.JL,u.Q7,u.sg,u.u,d.NW,Z.Hw,A.lW,g.KE,g.hX,T.Nt,c.a8,c.dk,c.dn,c.n5,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk]}),i})()}}]);